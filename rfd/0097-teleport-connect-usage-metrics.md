---
authors: Grzegorz Zdunek (grzegorz.zdunek@goteleport.com)
state: draft
 ---

# RFD 97 - Teleport Connect usage metrics

## Required Approvers

* Engineering:? @ravicious @zmb3
* Product: @klizhentas @xinding33

## What

Collect downloads and usage metrics of Teleport Connect.

## Why

Currently, the team has no information on how many users download, install and use Teleport Connect on a daily basis.
In order to effectively plan the development of the product, the team should also know what is the adoption of new
features, which ones are the most popular and which are problematic for users.

## Details

Connect will have a stateless metrics service that will send events to an unauthorized gRPC endpoint, exposed by TSH
daemon. The anonymization should be done in `tshd` (to be open on how it is done and what is sent further). Events will
be sent to `prehog` directly.
It was considered to use authorized endpoint provided by cluster's `Auth Service`, but it seems to not work well for
Connect for a few reasons:

- Some events do not belong to any cluster, like _app start_ event.
- A user can use Connect while not logged in. For example, new tabs can be opened after the session expires.

Since Connect will use endpoint that is not aware of the cluster context, it must provide some value that will
differentiate events coming from multiple application instances. To do this, each event will have `distinct_id` field.
It will be supplied with UUID generated by Connect, which will be generated once and stored in a file in the _App Data_
directory, so it won't change between restarts.

### User agreement

On the start, Teleport Connect will ask user to opt in to volunteer anonymized metrics and usage-data with standard
message "Are you OK sending anonymized usage data about Teleport Connect? This will help us to improve product".

If the user refuses, no data will be collected.

### How will collecting metrics support product development?

In the initial version, it should help with getting answers to the following questions:

#### How many unique users download and use Teleport Connect today?

To answer the first part of the question, download counts from `goteleport.com/download` are needed.
This task should be done by the marketing team.

To calculate how many users use Teleport Connect on a daily basis, a metric like DAU (Daily Active Users) can be used.
This metric can be based on a specific event, but in this case it should be calculated using any event. For example,
user logged only once in a given day to refresh certs for a DB proxy connection - such user can be considered as active.

#### What features are the most popular?

Usage of each feature will be measured basing on events from the [events](#events) section. They will allow to generate
various statistics, like the most common opened kinds of tabs or just show the usage of particular UI elements.

#### Where users struggle the most?

//TODO

#### What platforms are the most popular?

This will be measured in two ways.

- Based on downloads count for each platform.
- Based on a real usage. Connect will emit _start app_ event that contains OS field. These events will be then
  aggregated by unique users.

#### How usage grows or shrinks over time?

PostHog allows to create [Trends](https://posthog.com/manual/trends) basing on DAU. It can be used to show how usage
changes in a given period of time.

## Events

### `connect.start`

Starting the app.

Event properties:

- `os`: one of `mac`/`windows`/`linux`
- `connect_version`: string

### `connect.cluster.add`

Successful adding a cluster.

Event properties:

- `root_cluster_name`: string - name of the added cluster

### `connect.cluster.login`

Successful login to a cluster.

Event properties:

- `root_cluster_name`: string
- `connector_type`: string

### `connect.workspace.change`

Changing a workspace.

Event properties:

- `target_root_cluster_name`: string

### `connect.leafClusterPicker.change`

Changing a leaf cluster.

Event properties:

- `root_cluster_name`: string
- `target_leaf_cluster_name`: string

### `connect.tab.open`

Opening a tab.

Event properties:

- `root_cluster_name`: string
- `leaf_cluster_name`: string (optional)
- `tab_kind`: one
  of `resource_list`/`terminal_ssh`/`terminal_kube`/`terminal_shell`/`db_proxy`/`create_access_request`/`review_access_request`

### `connect.connectionsPicker.item.select`

Selecting an item from the connections picker.

Event properties:

- `root_cluster_name`: string
- `leaf_cluster_name`: string (optional)
- `connection_kind`: one of `ssh`/`kube`/`db`

### `connect.commandBar.command.run`

Running a command from command bar.

Event properties:

- `root_cluster_name`: string
- `leaf_cluster_name`: string (optional)

### `connect.commandBbar.autocomplete.select`

Selecting autocomplete item from the command bar suggestions.

Event properties:

- `root_cluster_name`: string
- `leaf_cluster_name`: string
- `suggestion`: one of `ssh_login`/`ssh_server`/`database`

### `connect.resourceTable.search`

Performing a resource search.

Event properties:

- `root_cluster_name`: string
- `leaf_cluster_name`: string
- `resource_kind`: one of `ssh`/`kube`/`db`
- `is_advanced`: boolean

### `connect.accessRequests.create`

Creating an access request.

Event properties:

- `root_cluster_name`: string
- `leaf_cluster_name`: string (optional)
- `requested_resources_count`: number

### `connect.accessRequests.review`

Reviewing an access request.

Event properties:

- `root_cluster_name`: string

### `connect.accessRequests.assumeRole`

Assuming a requested role.

Event properties:

- `root_cluster_name`: string

### `connect.fileTransfer.run`

Running file transfer.

Event properties:

- `root_cluster_name`: string
- `leaf_cluster_name`: string (optional)
- `direction`: one of `upload`/`download`

### `connect.dbProxy.runCli`

Clicking on _Run_ in DB proxy connection (to measure how many people use CLI to interact with DB).

Event properties:

- `root_cluster_name`: string
- `leaf_cluster_name`: string (optional)
- `protocol`: string (postgres, mssql, etc.)